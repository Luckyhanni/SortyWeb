@page "/"
@inject OrderService OrderService
@rendermode InteractiveServer

<PageTitle>Dashboard</PageTitle>

<div class="container mt-4">

    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold mb-2">Metzgerei Sorty</h1>
        <p class="text-muted">Übersicht & Steuerung</p>
    </div>

    <div class="row g-3 mb-5 justify-content-center">

        <div class="col-md-4 col-sm-6">
            <div class="card p-3 border-0 shadow-sm d-flex flex-row align-items-center h-100 animate__animated animate__fadeInUp">
                <div class="rounded-circle d-flex align-items-center justify-content-center bg-blue-light text-primary me-3" style="width: 60px; height: 60px;">
                    <i class="bi bi-box-seam-fill fs-2"></i>
                </div>
                <div>
                    <h3 class="fw-bold m-0">@stats.OpenOrders</h3>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Offene Bestellungen</small>
                </div>
            </div>
        </div>

        <div class="col-md-4 col-sm-6">
            <div class="card p-3 border-0 shadow-sm d-flex flex-row align-items-center h-100 animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
                <div class="rounded-circle d-flex align-items-center justify-content-center bg-green-light text-success me-3" style="width: 60px; height: 60px;">
                    <i class="bi bi-check-lg fs-1"></i>
                </div>
                <div>
                    <h3 class="fw-bold m-0">@stats.PickedUpOrders</h3>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Bereits Abgeholt</small>
                </div>
            </div>
        </div>

        <div class="col-md-4 col-sm-12">
            <div class="card p-3 border-0 shadow-sm d-flex flex-row align-items-center h-100 animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
                <div class="rounded-circle d-flex align-items-center justify-content-center bg-orange-light text-warning me-3" style="width: 60px; height: 60px;">
                    <i class="bi bi-clock-history fs-2"></i>
                </div>
                <div>
                    <h4 class="fw-bold m-0 text-dark">@GetTimeSinceLast()</h4>
                    <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Seit letzter Abholung</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center g-4">
        <div class="col-md-5">
            <a href="entry" class="card text-decoration-none shadow-lg hover-up border-0 h-100" style="background: linear-gradient(135deg, #212529 0%, #343a40 100%); color: white; min-height: 200px;">
                <div class="card-body p-5 d-flex flex-column justify-content-center align-items-center">
                    <i class="bi bi-keyboard fs-1 mb-3 opacity-75"></i>
                    <h2 class="fw-bold">Büro / Annahme</h2>
                    <p class="text-white-50 m-0">Neue Bestellungen erfassen</p>
                </div>
            </a>
        </div>

        <div class="col-md-5">
            <a href="runner" class="card text-decoration-none shadow-lg hover-up border-0 h-100" style="background: linear-gradient(135deg, #007AFF 0%, #0056b3 100%); color: white; min-height: 200px;">
                <div class="card-body p-5 d-flex flex-column justify-content-center align-items-center">
                    <i class="bi bi-phone fs-1 mb-3 opacity-75"></i>
                    <h2 class="fw-bold">Läufer / Handy</h2>
                    <p class="text-white-50 m-0">Bestellungen suchen & abholen</p>
                </div>
            </a>
        </div>
    </div>
</div>

<style>
    .hover-up {
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .hover-up:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15) !important;
        }

    .bg-blue-light {
        background-color: rgba(0, 122, 255, 0.1);
    }

    .bg-green-light {
        background-color: rgba(52, 199, 89, 0.1);
    }

    .bg-orange-light {
        background-color: rgba(255, 149, 0, 0.1);
    }
</style>

@code {
    private DashboardStats stats = new DashboardStats(0, 0, null);

    protected override async Task OnInitializedAsync()
    {
        stats = await OrderService.GetDashboardStatsAsync();

        // Optional: Timer starten, um die Zeit live zu aktualisieren?
        // Fürs Erste reicht Laden bei Page-Load/Refresh
    }

    private string GetTimeSinceLast()
    {
        if (stats.LastPickupTime == null) return "-";

        var diff = DateTime.Now - stats.LastPickupTime.Value;

        if (diff.TotalMinutes < 1) return "Gerade eben";
        if (diff.TotalMinutes < 60) return $"{diff.Minutes} Min";
        if (diff.TotalHours < 24) return $"{diff.Hours} Std {diff.Minutes} Min";

        return "> 1 Tag";
    }
}